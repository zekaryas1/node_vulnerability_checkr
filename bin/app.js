#!/usr/bin/env node
const {readPackageJson, getAllDependencies, prettyPrint} = require("./common");
const index = require("./osvindex");
const axios = require("axios");
const term = require('terminal-kit').terminal;

/**
 * entry point of the program
 * @returns {Promise<void>}
 */
const runProgram = async () => {
    const content = await readPackageJson("./package.json");
    const dependencies = await getAllDependencies(content);
    const responses = await index.makeRequest(index.format(dependencies));

    if (responses.length === 0) {
        term.green.bold(`\n-> Congratulation! Program Found 0 vulnerabilities In total\n`);
        return;
    }

    term.bold.red(`\n-> Program Found ${responses.length} vulnerabilities In total\n`);
    prettyPrint(responses);
};

term.bold.underline("Using https://ossindex.sonatype.org to check vulnerability...\n");
runProgram();