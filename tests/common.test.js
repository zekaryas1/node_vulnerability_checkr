const {severityNumberToWord, getColor, getNameAndVersion, getAllDependencies} = require("../bin/common");


/* severityNumberToWord */
test('number below 7 are moderate', () => {
    expect(severityNumberToWord(5)).toBe('MODERATE');
    expect(severityNumberToWord(7)).not.toBe('MODERATE');
})

test('number above 7 are HIGH', () => {
    expect(severityNumberToWord(7)).toBe('HIGH');
    expect(severityNumberToWord(10)).not.toBe('MODERATE');
})


/* getColor */
test('red color for high severity', () => {
    expect(getColor('HIGH')).toBe('^R');
})
test('yellow color for MODERATE and other severity', () => {
    expect(getColor('MODERATE')).toBe('^Y');
    expect(getColor('LOW')).toBe('^Y');
})


/* getNameAndVersion */
test("normal versions return themselves", () => {
    expect(getNameAndVersion("axios", "1.0.0")).toEqual({
        packageName: "axios",
        version: "1.0.0"
    })
});

test("package name with @ at beginning is removed", () => {
    expect(getNameAndVersion("@axios", "1.0.0")).toEqual({
        packageName: "axios",
        version: "1.0.0"
    })
});

test("package version with ^ at beginning is removed", () => {
    expect(getNameAndVersion("@axios", "^1.0.0")).toEqual({
        packageName: "axios",
        version: "1.0.0"
    })
});

test("package version with ~ at beginning is removed", () => {
    expect(getNameAndVersion("@axios", "~1.x.0")).toEqual({
        packageName: "axios",
        version: "1.x.0"
    })
});

/* getAllDependencies */
test("merged dependency is returned", () => {
    const content = `{
        "dependencies": {
            "axios": "^1.2.1",
            "terminal-kit": "^3.0.0",
            "yargs": "^17.6.2"
        },
        "devDependencies": {
            "jest": "^29.3.1",
            "nodemon": "^2.0.12"
        }
    }`;
    expect(getAllDependencies(content)).toEqual({
        "axios": "^1.2.1",
        "terminal-kit": "^3.0.0",
        "yargs": "^17.6.2",
        "jest": "^29.3.1",
        "nodemon": "^2.0.12"
    })
});

test("merged dependency is returned for only dependencies", () => {
    const content = `{
        "dependencies": {
            "axios": "^1.2.1",
            "terminal-kit": "^3.0.0",
            "yargs": "^17.6.2"
        }
    }`;
    expect(getAllDependencies(content)).toEqual({
        "axios": "^1.2.1",
        "terminal-kit": "^3.0.0",
        "yargs": "^17.6.2"
    })
});


test("merged dependency is returned for only devDependencies", () => {
    const content = `{
        "devDependencies": {
            "jest": "^29.3.1",
            "nodemon": "^2.0.12"
        }
    }`;
    expect(getAllDependencies(content)).toEqual({
        "jest": "^29.3.1",
        "nodemon": "^2.0.12"
    })
});